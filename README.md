# Автогенерируемая документация dbt-моделей на основе YandexGPT
Python-скрипт `generate_documentation.py` позволяет автоматически создать документацию для **существующей** dbt-модели в формате YAML-документа, а встроенная функция `fill_yaml_with_column_description()`, используя LLM-модель [YandexGPT](https://cloud.yandex.ru/ru/services/yandexgpt), дополнит её описанием колонок на русском языке. 

## Перед началом работы
1. В корне dbt-проекта необходимо создать файл `.env` и добавить в него секреты:
   1. `DBT_PROFILES_DIR=<путь к локальному profiles.yml>`
   2. `API_KEY=<секретный ключ>` - необходим для обращения к YandexGPT API. Найти его можно в [Vault](https://vault.dp.corp.uni.rest/ui/vault/secrets/yadp/show/accounts/yadp-yandexgpt).
2. В скрипте используется макрос из пакета [dbt-codegen](https://github.com/dbt-labs/dbt-codegen), поэтому необходимо удостовериться, что он установлен. Установить пакеты можно командой:
```bash
$ dbt deps
```

## generate_documentation.py
Запустить скрипт можно из корня dbt-проекта командой:
```bash
$ python scripts/generate_documentation.py --model <имя dbt-модели>
```
или непосредственно из директории `scripts` командой:
```bash
$ python generate_documentation.py --model <имя dbt-модели>
```
**Результатом** работы скрипта будет являться текстовая строка в консоли, отформатированная в приемлемый для dbt формат документации. 
### Входные параметры
1. `-m <model_name>` или `--model <model_name>` - **обязательный параметр**. Наименование существующей модели в текущем dbt-проекте.
2.  `-s` или `--save` - **по умолчанию False**: Если указан, то сгенерированная документация сохраняется в yml-файл в ту же директорию и с тем же названием, что и указанная модель.
3. `-e` или `--examples` - **по умолчанию False**: Если указан, то YandexGPT постарается помимо общего описания колонки также дополнительно указать возможные принимаемые значения (особенно актуально, если в SQL-запросе для колонки явно указаны значения через CASE).
4. `-v` или `--verbose` - **по умолчанию False**: Если указан, то ответ от YandexGPT API будет выведен в консоль.

Посмотреть список всех входных параметров можно командой:
```bash
$ python generate_documentation.py -h
```